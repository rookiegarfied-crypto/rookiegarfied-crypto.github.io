<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Generate DOCX Example</title>
    <style>
        .param { margin-bottom: 8px; }
        .hidden { display: none; }
    </style>
</head>

<body>

<h2>Input 9 Parameters</h2>

<div id="step1">
    <div id="params"></div>
    <button id="generateBtn">Generate DOCX</button>
</div>

<h2 class="hidden" id="step2Title">Download Your File</h2>
<div id="step2" class="hidden">
    <a id="downloadLink" href="#">Click to Download .docx</a>
</div>

<!-- ============================ -->
<!--   REQUIRED LIBRARIES (CDN)   -->
<!-- ============================ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pizzip/3.1.4/pizzip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.37.14/docxtemplater.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<script>
// -----------------------------------
// 1. 创建 9 个输入框
// -----------------------------------
for (let i = 1; i <= 9; i++) {
    let div = document.createElement("div");
    div.className = "param";
    div.innerHTML = `Param ${i}: <input id="param${i}" type="text">`;
    document.getElementById("params").appendChild(div);
}

// -----------------------------------
// 2. 点击生成 DOCX
// -----------------------------------
document.getElementById("generateBtn").addEventListener("click", async () => {

    // 获取参数
    const data = {};
    for (let i = 1; i <= 9; i++) {
        data[`p${i}`] = document.getElementById(`param${i}`).value;
    }

    // -------------------------------
    // 加载 DOCX 模板
    // -------------------------------
    const templateUrl = "https://cdn.jsdelivr.net/gh/OfficeDev/docxtemplater-require-example/template.docx";

    const response = await fetch(templateUrl);
    const arrayBuffer = await response.arrayBuffer();

    const zip = new PizZip(arrayBuffer);

    const doc = new window.docxtemplater(zip, {
        paragraphLoop: true,
        linebreaks: true,
    });

    // DOCX 模板中需要使用 {{p1}}, {{p2}} ... {{p9}}
    doc.setData(data);

    try {
        doc.render();
    } catch (error) {
        console.error("Docxtemplater Error:", error);
        alert("Error rendering the DOCX file.");
        return;
    }

    const out = doc.getZip().generate({
        type: "blob",
        mimeType:
            "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
    });

    // 下载文件
    saveAs(out, "Generated.docx");

    document.getElementById("step2Title").classList.remove("hidden");
    document.getElementById("step2").classList.remove("hidden");
});
</script>

</body>
</html>
